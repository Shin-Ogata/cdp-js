/*!
 * cdp.tools.js 2.2.0
 *
 * Date: 2018-01-24T03:45:55.670Z
 */
(function(root,factory){if(typeof define==="function"&&define.amd){define(["cdp.core","cdp.promise"],function(){return factory(root.CDP||(root.CDP={}),root.jQuery||root.$)})}else{factory(root.CDP||(root.CDP={}),root.jQuery||root.$)}})((this||0).self||global,function(CDP,$){CDP.Tools=CDP.Tools||{};var CDP;(function(CDP){var RESULT_CODE_BASE;(function(RESULT_CODE_BASE){RESULT_CODE_BASE[RESULT_CODE_BASE["CDP_TOOLS_DECLARERATION"]=0]="CDP_TOOLS_DECLARERATION";RESULT_CODE_BASE[RESULT_CODE_BASE["CDP_TOOLS"]=4*CDP._MODULE_RESULT_CODE_RANGE_CDP]="CDP_TOOLS"})(RESULT_CODE_BASE=CDP.RESULT_CODE_BASE||(CDP.RESULT_CODE_BASE={}));var FUNCTION_CODE_RANGE=10;var LOCAL_CODE_BASE;(function(LOCAL_CODE_BASE){LOCAL_CODE_BASE[LOCAL_CODE_BASE["FUNCTIONS"]=0]="FUNCTIONS";LOCAL_CODE_BASE[LOCAL_CODE_BASE["BLOB"]=1*FUNCTION_CODE_RANGE]="BLOB"})(LOCAL_CODE_BASE||(LOCAL_CODE_BASE={}));var RESULT_CODE;(function(RESULT_CODE){RESULT_CODE[RESULT_CODE["ERROR_CDP_TOOLS_DECLARATION"]=0]="ERROR_CDP_TOOLS_DECLARATION";RESULT_CODE[RESULT_CODE["ERROR_CDP_TOOLS_IMAGE_LOAD_FAILED"]=CDP.DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP_TOOLS,LOCAL_CODE_BASE.FUNCTIONS+1,"image load failed.")]="ERROR_CDP_TOOLS_IMAGE_LOAD_FAILED";RESULT_CODE[RESULT_CODE["ERROR_CDP_TOOLS_INVALID_IMAGE"]=CDP.DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP_TOOLS,LOCAL_CODE_BASE.FUNCTIONS+2,"invalid image.")]="ERROR_CDP_TOOLS_INVALID_IMAGE";RESULT_CODE[RESULT_CODE["ERROR_CDP_TOOLS_FILE_READER_ERROR"]=CDP.DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP_TOOLS,LOCAL_CODE_BASE.BLOB+1,"FileReader method failed.")]="ERROR_CDP_TOOLS_FILE_READER_ERROR"})(RESULT_CODE=CDP.RESULT_CODE||(CDP.RESULT_CODE={}))})(CDP||(CDP={}));var CDP;(function(CDP){var Tools;(function(Tools){var Promise=CDP.Promise;var TAG="[CDP.Tools.Binary] ";var Binary=function(){function Binary(){}Binary.getBlobBuilder=function(){return CDP.global.BlobBuilder||CDP.global.WebKitBlobBuilder||CDP.global.MozBlobBuilder||CDP.global.MSBlobBuilder};Binary.makeErrorInfoFromDOMError=function(resultCode,cause,tag,message){var _cause;if(cause){_cause={name:cause.name,message:cause.name}}return CDP.makeErrorInfo(resultCode,tag,message,_cause)};Binary.newBlob=function(blobParts,options){if(CDP.global.Blob){return new CDP.global.Blob(blobParts,options)}else{options=options||{};var blobBuilderObject=Binary.getBlobBuilder();var blobBuilder=new blobBuilderObject;var parts=blobParts instanceof Array?blobParts[0]:blobParts;blobBuilder.append(parts);return blobBuilder.getBlob(options.type)}};Binary.arrayBufferToBlob=function(buf,mimeType){return Binary.newBlob([buf],{type:mimeType})};Binary.base64ToBlob=function(base64,mimeType){return Binary.newBlob([Binary.base64ToArrayBuffer(base64)],{type:mimeType})};Binary.dataUrlToBlob=function(dataUrl,mimeType){if(mimeType===void 0){mimeType="image/png"}var base64=dataUrl.split(",")[1];return Binary.base64ToBlob(base64,mimeType)};Binary.base64ToArrayBuffer=function(base64){var bytes=window.atob(base64);var arrayBuffer=new ArrayBuffer(bytes.length);var data=new Uint8Array(arrayBuffer);for(var i=0,len=bytes.length;i<len;++i){data[i]=bytes.charCodeAt(i)}return arrayBuffer};Binary.base64ToUint8Array=function(encoded){var bytes=window.atob(encoded);var data=new Uint8Array(bytes.length);for(var i=0,len=bytes.length;i<len;++i){data[i]=bytes.charCodeAt(i)}return data};Binary.arrayBufferToBase64=function(arrayBuffer){var bytes=new Uint8Array(arrayBuffer);return Binary.uint8ArrayToBase64(bytes)};Binary.uint8ArrayToBase64=function(bytes){var data="";for(var i=0,len=bytes.byteLength;i<len;++i){data+=String.fromCharCode(bytes[i])}return window.btoa(data)};Binary.readBlobAsArrayBuffer=function(blob){var reader=new FileReader;var cancel=function(){return reader.abort()};return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)};reader.onerror=function(){reject(Binary.makeErrorInfoFromDOMError(CDP.RESULT_CODE.ERROR_CDP_TOOLS_FILE_READER_ERROR,reader.error,TAG,"FileReader.readAsArrayBuffer() failed."))};reader.readAsArrayBuffer(blob)},cancel)};Binary.readBlobAsUint8Array=function(blob){return new Promise(function(resolve,reject,dependOn){dependOn(Binary.readBlobAsArrayBuffer(blob)).then(function(result){resolve(new Uint8Array(result))}).catch(function(error){reject(error)})})};Binary.readBlobAsText=function(blob,encode){if(encode===void 0){encode="utf-8"}var reader=new FileReader;var cancel=function(){return reader.abort()};return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)};reader.onerror=function(){reject(Binary.makeErrorInfoFromDOMError(CDP.RESULT_CODE.ERROR_CDP_TOOLS_FILE_READER_ERROR,reader.error,TAG,"FileReader.readAsText() failed."))};reader.readAsText(blob,encode)},cancel)};Binary.readBlobAsDataURL=function(blob){var reader=new FileReader;var cancel=function(){return reader.abort()};return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)};reader.onerror=function(){reject(Binary.makeErrorInfoFromDOMError(CDP.RESULT_CODE.ERROR_CDP_TOOLS_FILE_READER_ERROR,reader.error,TAG,"FileReader.readAsDataURL() failed."))};reader.readAsDataURL(blob)},cancel)};Binary.blobURL=function(){return CDP.global.URL||CDP.global.webkitURL}();return Binary}();Tools.Binary=Binary})(Tools=CDP.Tools||(CDP.Tools={}))})(CDP||(CDP={}));var CDP;(function(CDP){var Tools;(function(Tools){var xhrSuccessStatus={0:200,1223:204};$.ajaxTransport("+binary",function(options,originalOptions,jqXHR){if(CDP.global.FormData&&(options.dataType&&options.dataType==="binary"||options.data&&(CDP.global.ArrayBuffer&&options.data instanceof ArrayBuffer||CDP.global.Blob&&options.data instanceof CDP.global.Blob))){var abortCallback_1;return{send:function(headers,callback){var xhr=new XMLHttpRequest;var url=options.url;var type=options.type;var async=options.async||true;var dataType=options.responseType||"blob";var data=options.data||null;var username=options.username||null;var password=options.password||null;var _callback=callback||function(){};xhr.addEventListener("load",function(){var _data={};_data[options.dataType]=xhr.response;_callback(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,_data,xhr.getAllResponseHeaders())});xhr.addEventListener("error",function(){var _data={};_data[options.dataType]=xhr.response;_callback(xhr.status,xhr.statusText,_data,xhr.getAllResponseHeaders())});xhr.addEventListener("abort",function(){var _data={};_data[options.dataType]=xhr.response;_callback(xhr.status,xhr.statusText,_data,xhr.getAllResponseHeaders())});abortCallback_1=function(){xhr.abort()};xhr.open(type,url,async,username,password);for(var i in headers){if(headers.hasOwnProperty(i)){xhr.setRequestHeader(i,headers[i])}}xhr.responseType=dataType;xhr.send(data)},abort:function(){if(abortCallback_1){abortCallback_1()}}}}})})(Tools=CDP.Tools||(CDP.Tools={}))})(CDP||(CDP={}));var CDP;(function(CDP){var Tools;(function(Tools){var Promise=CDP.Promise;var TAG="[CDP.Tools.Functions] ";function abs(x){return x>=0?x:-x}Tools.abs=abs;function max(lhs,rhs){return lhs>=rhs?lhs:rhs}Tools.max=max;function min(lhs,rhs){return lhs<=rhs?lhs:rhs}Tools.min=min;function toZeroPadding(no,limit){var signed="";no=Number(no);if(isNaN(no)||isNaN(limit)||limit<=0){return null}if(no<0){no=Tools.abs(no);signed="-"}return signed+(Array(limit).join("0")+no).slice(-limit)}Tools.toZeroPadding=toZeroPadding;function getStringSize(src){return Tools.Binary.newBlob([src],{type:"text/plain"}).size}Tools.getStringSize=getStringSize;function toStringChunks(src,limit){var chunks=[];var setChunk=function(input){if(limit<getStringSize(input)){var half=Math.floor(input.length/2);var lhs=input.slice(0,half);var rhs=input.slice(half);return[lhs,rhs]}else{chunks.push(input);return[]}};var makeChunk=function(work){var failures=setChunk(work);while(0<failures.length){makeChunk(failures.shift())}};makeChunk(src);return chunks}Tools.toStringChunks=toStringChunks;function inherit(subClass,superClass){var _prototype=subClass.prototype;function _inherit(){this.constructor=subClass}_inherit.prototype=superClass.prototype;subClass.prototype=new _inherit;$.extend(subClass.prototype,_prototype)}Tools.inherit=inherit;function mixin(derived){var bases=[];for(var _i=1;_i<arguments.length;_i++){bases[_i-1]=arguments[_i]}bases.forEach(function(base){Object.getOwnPropertyNames(base.prototype).forEach(function(name){derived.prototype[name]=base.prototype[name]})})}Tools.mixin=mixin;function extend(protoProps,staticProps){var parent=this;var child;if(protoProps&&protoProps.hasOwnProperty("constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}$.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps){$.extend(child.prototype,protoProps)}child.__super__=parent.prototype;return child}Tools.extend=extend;function getDevicePixcelRatio(){var mediaQuery;var is_firefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(null!=window.devicePixelRatio&&!is_firefox){return window.devicePixelRatio}else if(window.matchMedia){mediaQuery="(-webkit-min-device-pixel-ratio: 1.5),                    (min--moz-device-pixel-ratio: 1.5),                    (-o-min-device-pixel-ratio: 3/2),                    (min-resolution: 1.5dppx)";if(window.matchMedia(mediaQuery).matches){return 1.5}mediaQuery="(-webkit-min-device-pixel-ratio: 2),                    (min--moz-device-pixel-ratio: 2),                    (-o-min-device-pixel-ratio: 2/1),                    (min-resolution: 2dppx)";if(window.matchMedia(mediaQuery).matches){return 2}mediaQuery="(-webkit-min-device-pixel-ratio: 0.75),                    (min--moz-device-pixel-ratio: 0.75),                    (-o-min-device-pixel-ratio: 3/4),                    (min-resolution: 0.75dppx)";if(window.matchMedia(mediaQuery).matches){return.7}}else{return 1}}Tools.getDevicePixcelRatio=getDevicePixcelRatio;var s_canvasFactory;function getCanvas(){s_canvasFactory=s_canvasFactory||document.createElement("canvas");return s_canvasFactory.cloneNode(false)}Tools.getCanvas=getCanvas;function ensureImageLoaded(url){var img=new Image;var destroy=function(){if(img){img.src="";img=null}};return new Promise(function(resolve,reject){img.onload=function(event){destroy();resolve(url)};img.onerror=function(event){destroy();reject(CDP.makeErrorInfo(CDP.RESULT_CODE.ERROR_CDP_TOOLS_IMAGE_LOAD_FAILED,TAG,"image load failed. [url: "+url+"]"))};img.src=url},destroy)}Tools.ensureImageLoaded=ensureImageLoaded;function resizeImage(src,longSideLength){var img=new Image;var destroy=function(){if(img){img.src="";img=null}};return new Promise(function(resolve,reject){img.onload=function(event){var canvas=getCanvas();var ih=img.height,iw=img.width,ia=ih/iw;var cw,ch;if(iw===0||0===ia){reject(CDP.makeErrorInfo(CDP.RESULT_CODE.ERROR_CDP_TOOLS_INVALID_IMAGE,TAG,"invalid image. [src: "+src+"]"))}else{if(longSideLength<=0){longSideLength=ia<1?iw:ih}if(ia<1){cw=longSideLength<iw?longSideLength:iw;ch=Math.round(cw*ia)}else{ch=longSideLength<ih?longSideLength:ih;cw=Math.round(ch/ia)}canvas.width=cw;canvas.height=ch;canvas.getContext("2d").drawImage(img,0,0,cw,ch);resolve(canvas.toDataURL())}destroy()};img.onerror=function(event){destroy();reject(CDP.makeErrorInfo(CDP.RESULT_CODE.ERROR_CDP_TOOLS_IMAGE_LOAD_FAILED,TAG,"image load failed. [src: "+src+"]"))};img.src=src})}Tools.resizeImage=resizeImage})(Tools=CDP.Tools||(CDP.Tools={}))})(CDP||(CDP={}));var CDP;(function(CDP){var Tools;(function(Tools){var TAG="[CDP.Tools.DateTime] ";var DateTime=function(){function DateTime(){}DateTime.computeDate=function(base,add,target){if(target===void 0){target="date"}var date=new Date(base.getTime());switch(target){case"year":date.setUTCFullYear(base.getUTCFullYear()+add);break;case"month":date.setUTCMonth(base.getUTCMonth()+add);break;case"date":date.setUTCDate(base.getUTCDate()+add);break;case"hour":date.setUTCHours(base.getUTCHours()+add);break;case"min":date.setUTCMinutes(base.getUTCMinutes()+add);break;case"sec":date.setUTCSeconds(base.getUTCSeconds()+add);break;case"msec":date.setUTCMilliseconds(base.getUTCMilliseconds()+add);break;default:console.warn(TAG+"unknown target: "+target);date.setUTCDate(base.getUTCDate()+add)}return date};DateTime.convertISOStringToDate=function(dateString){var dateValue=this.convertISOStringToDateValue(dateString);return new Date(dateValue)};DateTime.convertDateToISOString=function(date,target){if(target===void 0){target="tz"}var isoDateString=date.toISOString();var offset=27===isoDateString.length?3:0;switch(target){case"year":return isoDateString.substr(0,offset+4);case"month":return isoDateString.substr(0,offset+7);case"date":return isoDateString.substr(0,offset+10);case"min":return isoDateString.substr(0,offset+16);case"sec":return isoDateString.substr(0,offset+19);case"msec":return isoDateString.substr(0,offset+23);case"tz":return isoDateString;default:console.warn(TAG+"unknown target: "+target);return isoDateString}};DateTime.convertFileSystemStringToDate=function(dateString){var dateValue=this.convertFileSystemStringToDateValue(dateString);return new Date(dateValue)};DateTime.convertDateToFileSystemString=function(date,target){if(target===void 0){target="msec"}var isoDateString=DateTime.convertDateToISOString(date,target);var fileSystemString=isoDateString.replace(/[-:.]/g,"_");return fileSystemString};DateTime.convertISOStringToDateValue=function(isoString){var reYear=/(\d{4}|[-+]\d{6})/;var reMonth=/(\d{2})/;var reDay=/(\d{2})/;var reDate=new RegExp(reYear.source+"(?:-"+reMonth.source+"(?:-"+reDay.source+")*)*");var reHours=/(\d{2})/;var reMinutes=/(\d{2})/;var reSeconds=/(\d{2})/;var reMs=/(\d{3})/;var reTime=new RegExp("T"+reHours.source+":"+reMinutes.source+"(?::"+reSeconds.source+"(?:."+reMs.source+")*)*");var reTz=/(Z|[-+]\d{2}:\d{2})/;var reISOString=new RegExp("^"+reDate.source+"(?:"+reTime.source+"(?:"+reTz.source+")*)*$");var result=reISOString.exec(isoString);if(null==result){return NaN}var year=parseInt(result[1],10);var month=parseInt(result[2],10)-1||0;var date=parseInt(result[3],10)||1;var hours=parseInt(result[4],10)||0;var minutes=parseInt(result[5],10)||0;var seconds=parseInt(result[6],10)||0;var ms=parseInt(result[7],10)||0;if(result[8]){switch(result[8][0]){case"Z":break;case"-":hours+=parseInt(result[8].substr(1,2),10)||0;minutes+=parseInt(result[8].substr(4,2),10)||0;break;case"+":hours-=parseInt(result[8].substr(1,2),10)||0;minutes-=parseInt(result[8].substr(4,2),10)||0;break;default:console.warn("invalid timezone in ISO string")}}return Date.UTC(year,month,date,hours,minutes,seconds,ms)};DateTime.convertFileSystemStringToDateValue=function(dateString){var reYear=/(\d{4}|[-+]\d{6})/;var reMonth=/(\d{2})/;var reDay=/(\d{2})/;var reDate=new RegExp(reYear.source+"(?:_"+reMonth.source+"(?:_"+reDay.source+")?)?");var reHours=/(\d{2})/;var reMinutes=/(\d{2})/;var reSeconds=/(\d{2})/;var reMs=/(\d{3})/;var reTime=new RegExp("T"+reHours.source+"_"+reMinutes.source+"(?:_"+reSeconds.source+"(?:_"+reMs.source+")?)?");var reFileSystemString=new RegExp("^"+reDate.source+"(?:"+reTime.source+")*$");var result=reFileSystemString.exec(dateString);if(null==result){return NaN}var year=parseInt(result[1],10);var month=parseInt(result[2],10)-1||0;var date=parseInt(result[3],10)||1;var hours=parseInt(result[4],10)||0;var minutes=parseInt(result[5],10)||0;var seconds=parseInt(result[6],10)||0;var ms=parseInt(result[7],10)||0;return Date.UTC(year,month,date,hours,minutes,seconds,ms)};return DateTime}();Tools.DateTime=DateTime})(Tools=CDP.Tools||(CDP.Tools={}))})(CDP||(CDP={}));var CDP;(function(CDP){var Tools;(function(Tools){var TAG="[CDP.Tools.Template] ";var Template=function(){function Template(){}Template.getTemplateElement=function(key,src,cache){if(src===void 0){src=null}if(cache===void 0){cache=true}var mapElement=Template.getElementMap();var $element=mapElement[key];try{if(!$element){if(src){var html=Template.findHtmlFromSource(src);$element=$(html).find(key)}else{$element=$(key)}if($element<=0){throw"invalid [key, src] = ["+key+", "+src+"]"}if(src&&cache){mapElement[key]=$element}}}catch(exception){console.error(TAG+exception);return null}return $element};Template.empty=function(){Template._mapElement=null;Template._mapSource=null};Template.getJST=function(key,src,cache){var template=null;var jst;var $element;if(key instanceof jQuery){$element=key}else{$element=Template.getTemplateElement(key,src,cache)}if(null!=CDP.global.Hogan){template=Hogan.compile($element.text());jst=function(data){return template.render(data)}}else if(null!=CDP.global._){template=_.template($element.html());jst=function(data){return template(data).replace(/\n|\t/g,"")}}else{console.warn(TAG+"cannot find template engine module.");console.warn("    'hogan' or 'underscore' is required.")}return jst};Template.getElementMap=function(){if(!Template._mapElement){Template._mapElement={}}return Template._mapElement};Template.getSourceMap=function(){if(!Template._mapSource){Template._mapSource={}}return Template._mapSource};Template.findHtmlFromSource=function(src){var mapSource=Template.getSourceMap();var html=mapSource[src];if(!html){$.ajax({url:src,method:"GET",async:false,dataType:"html",success:function(data){html=data},error:function(data,status){throw"ajax request failed. status: "+status}});mapSource[src]=html}return html};return Template}();Tools.Template=Template})(Tools=CDP.Tools||(CDP.Tools={}))})(CDP||(CDP={}));var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};var CDP;(function(CDP){var Tools;(function(Tools){var TAG="[CDP.Tools.ProgressCounter] ";var ProgressCounter=function(){function ProgressCounter(options){this.reset(options)}ProgressCounter.prototype.reset=function(options){this._settings=__assign({max:100,beginTime:Date.now(),allowIncrementRemain:false,lastRemainTime:Infinity},options)};ProgressCounter.prototype.compute=function(progress){var passTime=Date.now()-this._settings.beginTime;var remainTime=Infinity;if(null!=progress&&0!==progress){remainTime=passTime*this._settings.max/progress-passTime}if(this._settings.allowIncrementRemain||remainTime<this._settings.lastRemainTime){this._settings.lastRemainTime=remainTime}else{remainTime=this._settings.lastRemainTime}return{passTime:passTime,remainTime:remainTime}};return ProgressCounter}();Tools.ProgressCounter=ProgressCounter})(Tools=CDP.Tools||(CDP.Tools={}))})(CDP||(CDP={}));return CDP.Tools});
//# sourceMappingURL=cdp.tools.min.js.map