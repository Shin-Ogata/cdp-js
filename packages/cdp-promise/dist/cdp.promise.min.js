/*!
 * cdp.promise.js 2.1.0
 *
 * Date: 2018-01-09T03:16:29.257Z
 */
(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],function($){return factory(root.CDP||(root.CDP={}),$,root)})}else if(typeof exports==="object"){module.exports=factory(root.CDP||(root.CDP={}),require("jquery"),root)}else{factory(root.CDP||(root.CDP={}),root.jQuery||root.$,root)}})((this||0).self||global,function(CDP,$,root){var CDP;(function(CDP){var TAG="[CDP.Promise] ";function makeCancelable(df,options){var extendOptions;var cancel;if("function"===typeof options){cancel=options}else{extendOptions=options;if(extendOptions&&extendOptions.cancelCallback){cancel=extendOptions.cancelCallback}else{cancel=function(){}}}var _abort=function(info){var originalMessage=info&&info.message?info.message:undefined;var detail=info?$.extend({},info,{message:"abort",originalMessage:originalMessage}):{message:"abort"};cancel(detail);if(null!=this.dependency){if(this.dependency.abort){this.dependency.abort(detail)}else{console.error(TAG+"[call] dependency object doesn't have 'abort()' method.")}if(this.callReject&&"pending"===this.state()){df.reject(detail)}}else if("pending"===this.state()){df.reject(detail)}};var _dependOn=function(promise){var _this=this;if(promise.abort){this.dependency=promise;promise.always(function(){_this.dependency=null})}else{console.error(TAG+"[set] dependency object doesn't have 'abort()' method.")}return promise};var _target=$.extend({},{dependency:null,callReject:false},extendOptions);return{df:df,target:_target,abort:_abort,dependOn:_dependOn}}function makePromise(df,options){var cancelable=makeCancelable(df,options);var promise=df.promise(cancelable.target);if(null==promise.abort){promise.abort=cancelable.abort.bind(promise)}if(null==promise.dependOn){promise.dependOn=cancelable.dependOn.bind(promise)}return promise}CDP.makePromise=makePromise;function wait(){var deferreds=[];for(var _i=0;_i<arguments.length;_i++){deferreds[_i]=arguments[_i]}var _deferreds=[].concat.apply([],deferreds);var df=$.Deferred();var results=[];var isFinished=function(){return!results.some(function(element){return"pending"===element.status})};_deferreds.forEach(function(deferred,index){results.push({status:"pending",args:null});deferred.then(function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}results[index].status="resolved";results[index].args=args},function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}results[index].status="rejected";results[index].args=args}).always(function(){if(isFinished()){df.resolve(results)}})});return df.promise()}CDP.wait=wait;function race(){var deferreds=[];for(var _i=0;_i<arguments.length;_i++){deferreds[_i]=arguments[_i]}var df=$.Deferred();var _deferreds=[].concat.apply([],deferreds);_deferreds.forEach(function(deferred,index){deferred.then(function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if("pending"===df.state()){df.resolve(args)}},function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if("pending"===df.state()){df.reject(args)}})});return df.promise()}CDP.race=race;var PromiseManager=function(){function PromiseManager(){this._pool=[];this._id=0}PromiseManager.prototype.add=function(promise){var _this=this;if(promise==null){return null}if(!promise.abort){console.error(TAG+"[add] promise object doesn't have 'abort()' method.");return promise}var cookie={promise:promise,id:this._id++};this._pool.push(cookie);promise.always(function(){_this._pool=_this._pool.filter(function(element){if(element.id!==cookie.id){return true}else{return false}})});return promise};PromiseManager.prototype.cancel=function(info){var promises=this.promises();promises.forEach(function(element){if(element.abort){element.abort(info)}});return wait.apply(null,promises)};PromiseManager.prototype.promises=function(){return this._pool.map(function(element){return element.promise})};return PromiseManager}();CDP.PromiseManager=PromiseManager;var PromiseConstructor=function(){function PromiseConstructor(executor,options){var cancelable=makeCancelable($.Deferred(),options);$.extend(true,this,cancelable.df,cancelable.target);this.abort=cancelable.abort.bind(this);this.dependOn=cancelable.dependOn.bind(this);executor(this.resolve,this.reject,this.dependOn)}PromiseConstructor.resolve=function(value){return $.Deferred().resolve(value)};PromiseConstructor.reject=function(reason){return $.Deferred().reject(reason)};PromiseConstructor.all=function(){var deferreds=[];for(var _i=0;_i<arguments.length;_i++){deferreds[_i]=arguments[_i]}return $.when.apply(this,[].concat.apply([],deferreds))};PromiseConstructor.wait=function(){var deferreds=[];for(var _i=0;_i<arguments.length;_i++){deferreds[_i]=arguments[_i]}return wait([].concat.apply([],deferreds))};PromiseConstructor.race=function(){var deferreds=[];for(var _i=0;_i<arguments.length;_i++){deferreds[_i]=arguments[_i]}return race([].concat.apply([],deferreds))};return PromiseConstructor}();CDP.PromiseConstructor=PromiseConstructor;CDP.Promise=PromiseConstructor})(CDP||(CDP={}));root.Promise=root.Promise||CDP.Promise;return CDP});
//# sourceMappingURL=cdp.promise.min.js.map