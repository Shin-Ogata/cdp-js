/*!
 * @cdp/framework-core 0.9.0
 *   core framework
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e=e||self,t(e.CDP=e.CDP||{}))}(this,(function(e){"use strict";function t(){return"object"==typeof globalThis?globalThis:Function("return this")()}function n(e,...n){let r=e||t();for(const e of n)r[e]=r[e]||{},r=r[e];return r}function r(e){return n(null,e)}function s(e="CDP",t="Config"){return n(r(e),t)}function o(e){return null!=e}function i(e){return null==e}function c(e){return"string"==typeof e}function a(e){return"number"==typeof e}function u(e){return"symbol"==typeof e}function l(e){return!e||"function"!=typeof e&&"object"!=typeof e}const f=Array.isArray;function h(e){return Boolean(e)&&"object"==typeof e}function p(e){return!!h(e)&&(!Object.getPrototypeOf(e)||m(Object,e))}function b(e){if(!p(e))return!1;for(const t in e)return!1;return!0}function g(e){return"function"==typeof e}function d(e){return Symbol.iterator in Object(e)}const y={Int8Array:!0,Uint8Array:!0,Uint8ClampedArray:!0,Int16Array:!0,Uint16Array:!0,Int32Array:!0,Uint32Array:!0,Float32Array:!0,Float64Array:!0};function w(e){return!!y[O(e)]}function m(e,t){return null!=t&&"function"==typeof e&&Object.getPrototypeOf(t)===Object(e.prototype)}function O(e){if(null!=e){const t=e[Symbol.toStringTag];if(c(t))return t;if(g(e)&&e.prototype&&null!=e.name)return e.name;{const t=e.constructor;if(g(t)&&t===Object(t.prototype).constructor)return t.name}}return Object.prototype.toString.call(e).slice(8,-1)}function E(e,t){return null==e&&null==t?O(e)===O(t):null!=e&&null!=t&&Object.getPrototypeOf(e)===Object.getPrototypeOf(t)}const _=Symbol("@cdp"),S={notNil:(e,t)=>{if(null==e)throw o(t)||(t=`${O(e)} is not a valid value.`),new TypeError(t)},typeOf:(e,t,n)=>{if(typeof t!==e)throw o(n)||(n=`Type of ${O(t)} is not ${e}.`),new TypeError(n)},array:(e,t)=>{if(!f(e))throw o(t)||(t=`${O(e)} is not an Array.`),new TypeError(t)},iterable:(e,t)=>{if(!(Symbol.iterator in Object(e)))throw o(t)||(t=`${O(e)} is not an iterable object.`),new TypeError(t)},instanceOf:(e,t,n)=>{if(!(t instanceof e))throw o(n)||(n=`${O(t)} is not an instance of ${e.name}.`),new TypeError(n)},ownInstanceOf:(e,t,n)=>{if(null==t||Object.getPrototypeOf(t)!==Object(e.prototype))throw o(n)||(n=`The object is not own instance of ${e.name}.`),new TypeError(n)},notOwnInstanceOf:(e,t,n)=>{if(null!=t&&Object.getPrototypeOf(t)===Object(e.prototype))throw o(n)||(n=`The object is own instance of ${e.name}.`),new TypeError(n)},hasProperty:(e,t,n)=>{if(null==e||!(t in e))throw o(n)||(n=`The object does not have property ${String(t)}.`),new TypeError(n)},hasOwnProperty:(e,t,n)=>{if(null==e||!Object.prototype.hasOwnProperty.call(e,t))throw o(n)||(n=`The object does not have own property ${String(t)}.`),new TypeError(n)}};function v(e,...t){S[e](...t)}function P(e,t){const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(!j(e[r],t[r]))return!1;return!0}function C(e,t){const n=e.byteLength;if(n!==t.byteLength)return!1;let r=0;if(n-r>=8){const s=n>>>3,o=new Float64Array(e,0,s),i=new Float64Array(t,0,s);for(let e=0;e<s;e++)if(!Object.is(o[e],i[e]))return!1;r=s<<3}if(r===n)return!0;const s=new DataView(e),o=new DataView(t);if(n-r>=4){if(!Object.is(s.getUint32(r),o.getUint32(r)))return!1;r+=4}if(n-r>=2){if(!Object.is(s.getUint16(r),o.getUint16(r)))return!1;r+=2}if(n>r){if(!Object.is(s.getUint8(r),o.getUint8(r)))return!1;r+=1}return r===n}function j(e,t){if(e===t)return!0;if(g(e)&&g(t))return e.length===t.length&&e.name===t.name;if(!h(e)||!h(t))return!1;{const n=e.valueOf(),r=t.valueOf();if(e!==n||t!==r)return n===r}{const n=e instanceof RegExp,r=t instanceof RegExp;if(n||r)return n===r&&String(e)===String(t)}{const n=f(e),r=f(t);if(n||r)return n===r&&P(e,t)}{const n=e instanceof ArrayBuffer,r=t instanceof ArrayBuffer;if(n||r)return n===r&&C(e,t)}{const n=ArrayBuffer.isView(e),r=ArrayBuffer.isView(t);if(n||r)return n===r&&E(e,t)&&C(e.buffer,t.buffer)}{const n=d(e),r=d(t);if(n||r)return n===r&&P([...e],[...t])}if(E(e,t)){const n=new Set(Object.keys(e)),r=new Set(Object.keys(t));if(n.size!==r.size)return!1;for(const e of n)if(!r.has(e))return!1;for(const r of n)if(!j(e[r],t[r]))return!1}else{for(const n in e)if(!(n in t))return!1;const n=new Set;for(const r in t){if(!(r in e))return!1;n.add(r)}for(const r of n)if(!j(e[r],t[r]))return!1}return!0}function R(e){const t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}function A(e,t,n){return e!==t||n&&void 0===e}function k(e,t){if(void 0===t||e===t)return e;if(!h(t))return t;if(t.valueOf()!==t)return j(e,t)?e:new t.constructor(t.valueOf());if(t instanceof RegExp)return j(e,t)?e:function n(e){const t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}(t);if(t instanceof ArrayBuffer)return j(e,t)?e:R(t);if(ArrayBuffer.isView(t))return j(e,t)?e:w(t)?function r(e){const t=R(e.buffer);return new e.constructor(t,e.byteOffset,e.length)}(t):function s(e){const t=R(e.buffer);return new DataView(t,e.byteOffset,e.byteLength)}(t);if(Array.isArray(t))return function o(e,t){for(let n=0,r=t.length;n<r;n++){const r=e[n],s=k(r,t[n]);!A(r,s,!1)||(e[n]=s)}return e}(f(e)?e:[],t);if(t instanceof Set)return function i(e,t){for(const n of t)e.has(n)||e.add(k(void 0,n));return e}(e instanceof Set?e:new Set,t);if(t instanceof Map)return function c(e,t){for(const[n,r]of t){const t=e.get(n),s=k(t,r);!A(t,s,!1)||e.set(n,s)}return e}(e instanceof Map?e:new Map,t);const a=h(e)?e:{};if(E(e,t))for(const e of Object.keys(t)){const n=a[e],r=k(n,t[e]);!A(n,r,!0)||(a[e]=r)}else for(const e in t){const n=a[e],r=k(n,t[e]);!A(n,r,!0)||(a[e]=r)}return a}function T(e,...t){let n=e;for(const e of t)n=k(n,e);return n}function D(e){return T(void 0,e)}const x=Object.prototype,M=Function.prototype[Symbol.hasInstance],L=Symbol("override"),$=Symbol("isInherited"),U=Symbol("constructors"),I=Symbol("classBase"),N=Symbol("classSources"),z=Symbol("protoExtendsOnly");function B(e,t,n){null==e[n]&&Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}function F(e,t){t&&Object.getOwnPropertyNames(t).filter(e=>!/(prototype|name|constructor)/.test(e)).forEach(n=>{B(e,t,n)}),t&&Object.getOwnPropertySymbols(t).forEach(n=>{B(e,t,n)})}function V(e,t){const n=t||(null===t?void 0:t=>Object.prototype.isPrototypeOf.call(e.prototype,t)),r=n&&Object.getOwnPropertyDescriptor(e,L);r||Object.defineProperties(e,{[Symbol.hasInstance]:{value:n,writable:!0,enumerable:!1},[L]:{value:!!n||void 0,writable:!0}})}function K(e,...t){let n=!1;class r extends e{constructor(...r){super(...r);const s=new Map;if(this[U]=s,this[I]=e,n)for(const e of t)if(!e[z]){const t={apply:(t,n,r)=>{const s=new e(...r);F(this,s)}};s.set(e,new Proxy(e,t))}}super(e,...t){const n=this[U],r=n.get(e);return r&&(r.call(this,...t),n.set(e,null)),this}isMixedWith(e){return this.constructor!==e&&(this[I]===e||this[N].reduce((t,n)=>t||e===n,!1))}static[Symbol.hasInstance](e){return Object.prototype.isPrototypeOf.call(r.prototype,e)}[$](e){const t=this[U];if(t.has(e))return!0;for(const n of t.keys())if(Object.prototype.isPrototypeOf.call(e,n))return!0;return!1}get[N](){return[...this[U].keys()]}}for(const e of t){const t=Object.getOwnPropertyDescriptor(e,Symbol.hasInstance);if(!t||t.writable){const n=t?e[Symbol.hasInstance]:M;V(e,t=>n.call(e,t)||!(null==t||!t[$])&&t[$](e))}F(r.prototype,e.prototype);let s=Object.getPrototypeOf(e.prototype);for(;x!==s;)F(r.prototype,s),s=Object.getPrototypeOf(s);n||(n=!e[z])}return r}const W=Math.random.bind(Math);async function G(e,t,n){return Promise.all(e.map(async(e,r,s)=>await t.call(n||this,e,r,s)))}const q=new Proxy((function H(){return q}),{get:(e,t)=>{const n=e[t];return null!=n?n:q}});function J(e){return e||function t(){const e=new Proxy({},{get:(e,t)=>{const n=e[t];return null!=n?n:q}});return Object.defineProperty(e,"stub",{value:!0,writable:!1}),e}()}const Z=t(),Q=J(Z.setTimeout),X=J(Z.clearTimeout),Y=J(Z.setInterval),ee=J(Z.clearInterval);function te(e){return Promise.resolve().then(e)}function ne(e){const t=t=>e[t],n=`(?:${Object.keys(e).join("|")})`,r=RegExp(n),s=RegExp(n,"g");return e=>(e=null==e||"symbol"==typeof e?"":String(e),r.test(e)?e.replace(s,t):e)}const re=ne({"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;","`":"&#x60;"});function se(e){return void 0===e||c(e)?e:h(e)?JSON.stringify(e):String(e)}function oe(e,t=!1){return null!=e?e:t?String(e):null}function ie(e){return"null"===e?null:"undefined"===e?void 0:e}function ce(e,t){return null!=e&&h(e)&&t in e}let ae=0;function ue(e,t=!1){const n=t?e.slice(1).toLowerCase():e.slice(1);return e.charAt(0).toUpperCase()+n}function le(e){return e.charAt(0).toLowerCase()+e.slice(1)}function fe(e,t=!1){return e=e.trim().replace(/[-_\s]+(.)?/g,(e,t)=>t?t.toUpperCase():""),!0===t?le(e):e}const he=new WeakMap;function pe(e){if(!he.has(e))throw new TypeError("This is not a valid EventPublisher.");return he.get(e)}function be(e){if(!c(e)&&!u(e))throw new TypeError(`Type of ${O(e)} is not a valid channel.`)}function ge(e){return null!=e&&v("typeOf","function",e),e}class de{constructor(){v("instanceOf",de,this),he.set(this,new Map)}publish(e,...t){const n=pe(this);be(e);const r=n.get(e);if(r)for(const e of r)try{const n=e(...t);if(!0===n)break}catch(e){Promise.reject(e)}}hasListener(e,t){const n=pe(this);if(null==e)return n.size>0;if(be(e),null==t)return n.has(e);ge(t);const r=n.get(e);return!!r&&r.has(t)}channels(){return[...pe(this).keys()]}on(e,t){const n=pe(this);ge(t);const r=f(e)?e:[e];for(const e of r)be(e),n.has(e)?n.get(e).add(t):n.set(e,new Set([t]));return Object.freeze({get enable(){for(const e of r){const r=n.get(e);if(!r||!r.has(t))return this.unsubscribe(),!1}return!0},unsubscribe(){for(const e of r){const r=n.get(e);r&&(r.delete(t),r.size>0||n.delete(e))}}})}once(e,t){const n=this.on(e,t),r=this.on(e,()=>{n.unsubscribe(),r.unsubscribe()});return n}off(e,t){const n=pe(this);if(null==e)return n.clear(),this;const r=f(e)?e:[e],s=ge(t);for(const e of r)if(be(e),null!=s){const t=n.get(e);t&&(t.delete(s),t.size>0||n.delete(e))}else n.delete(e);return this}}const ye=de;ye.prototype.trigger=de.prototype.publish;const we=Symbol("context");function me(e,t,n,r){const s=[],o=f(n)?n:[n];for(const n of o){const o=t.on(n,r);e.set.add(o),s.push(o);const i=e.map.get(t)||new Map,c=i.get(n)||new Map;c.set(r,o),i.has(n)||i.set(n,c),e.map.has(t)||e.map.set(t,i)}return Object.freeze({get enable(){for(const e of s)if(e.enable)return!0;return!1},unsubscribe(){for(const e of s)e.unsubscribe()}})}function Oe(e,t,n,r){if(null!=t){t.off(n,r);const s=e.map.get(t);if(!s)return;if(null!=n){const t=f(n)?n:[n];for(const n of t){const t=s.get(n);if(!t)return;if(r){const n=t.get(r);n&&(n.unsubscribe(),e.set.delete(n)),t.delete(r)}else for(const n of t.values())n.unsubscribe(),e.set.delete(n)}}else for(const t of s.values())for(const n of t.values())n.unsubscribe(),e.set.delete(n)}else{for(const t of e.set)t.unsubscribe();e.map=new WeakMap,e.set.clear()}}class Ee{constructor(){this[we]={map:new WeakMap,set:new Set}}listenTo(e,t,n){return me(this[we],e,t,n)}listenToOnce(e,t,n){const r=me(this[we],e,t,n),s=e.on(t,()=>{Oe(this[we],e,t,n),s.unsubscribe()});return r}stopListening(e,t,n){return Oe(this[we],e,t,n),this}}class _e extends(K(ye,Ee)){constructor(){super(),this.super(Ee)}}const Se=_e,ve=Symbol("cancel"),Pe=Symbol("close"),Ce=Object.freeze({enable:!1,unsubscribe(){}}),je=new WeakMap;function Re(e){if(!je.has(e))throw new TypeError("The object is not a valid CancelToken.");return je.get(e)}class Ae{static source(...e){let t,n;const r=new Ae((e,r)=>{t=e,n=r},...e);return Object.freeze({token:r,cancel:t,close:n})}constructor(e,...t){v("instanceOf",Ae,this),v("typeOf","function",e);const n=new Set(t.filter(e=>je.has(e)));let r=0;for(const e of n)r|=Re(e).status;const s={broker:new ye,subscriptions:new Set,reason:void 0,status:r};je.set(this,Object.seal(s));const o=this[ve],i=this[Pe];if(0===r)for(const e of n)s.subscriptions.add(e.register(o.bind(this))),this.register(o.bind(e));e(o.bind(this),i.bind(this))}get reason(){return Re(this).reason}get cancelable(){return 0===Re(this).status}get requested(){return!!(1&Re(this).status)}get closed(){return!!(2&Re(this).status)}get[Symbol.toStringTag](){return"CancelToken"}register(e){const t=Re(this);return this.cancelable?t.broker.on("cancel",e):Ce}[ve](e){const t=Re(this);if(v("notNil",e),this.cancelable){t.reason=e,t.status|=1;for(const e of t.subscriptions)e.unsubscribe();t.broker.trigger("cancel",e),Promise.resolve().then(()=>this[Pe]())}}[Pe](){const e=Re(this);if(!this.closed){e.status|=2;for(const t of e.subscriptions)t.unsubscribe();e.subscriptions.clear(),e.broker.off()}}}const ke=Promise,Te=Symbol("create"),De=new WeakMap;class xe extends ke{static get[Symbol.species](){return ke}static resolve(e,t){return this[Te](super.resolve(e),t)}static[Te](e,t,n){let r;if(v("instanceOf",ke,e),t instanceof Ae)if(!n||g(n[0])&&!g(n[1]))if(t.cancelable){let n;r=new ke((r,s)=>{n=t.register(s),super.prototype.then.call(e,r,s)});const s=()=>{n.unsubscribe(),De.delete(r)};r.then(s,s)}else if(t.requested)r=super.reject(t.reason);else{if(!t.closed)throw new Error("Unexpected Exception");r=e}else r=e;else r=e;return n&&(r=super.prototype.then.apply(r,n)),t&&t.cancelable&&De.set(r,t),r instanceof this||Object.setPrototypeOf(r,this.prototype),r}constructor(e,t){return super(e),xe[Te](this,t)}then(e,t){return xe[Te](this,De.get(this),[e,t])}catch(e){return this.then(void 0,e)}finally(e){return xe[Te](super.finally(e),De.get(this))}}function Me(e){return Promise=e?xe:ke,Promise}function Le(e){const t=e.map(e=>e.catch(e=>e));return Promise.all(t)}function $e(e){return Promise.resolve(void 0,e)}Me(!s().noAutomaticNativeExtend);const Ue=/(abort|cancel)/im;class Ie{get(){return this._broker||(this._broker=new ye)}}const Ne=Symbol("internal"),ze=Symbol("notify"),Be=Symbol("stock-change"),Fe=Symbol("notify-changes");function Ve(e){if(!e||!e[Ne])throw new TypeError("The object passed is not an IObservable.")}const Ke={set(e,t,n,r){if(!c(t))return Reflect.set(e,t,n,r);const s=e[t];return"disabled"!==e[Ne].state&&n!==s&&e[Be](t,s),Reflect.set(e,t,n,r)}};Object.freeze(Ke);class We{constructor(e="active"){v("instanceOf",We,this);const t={state:e,changed:!1,changeMap:new Map,broker:new Ie};return Object.defineProperty(this,Ne,{value:Object.seal(t)}),new Proxy(this,Ke)}on(e,t){Ve(this);const{changeMap:n,broker:r}=this[Ne],s=r.get().on(e,t);if(0<n.size){const t=f(e)?e:[e];for(const e of t)n.has(e)||n.set(e,this[e])}return s}off(e,t){Ve(this),this[Ne].broker.get().off(e,t)}suspend(e=!1){return Ve(this),this[Ne].state=e?"disabled":"suspended",e&&this[Ne].changeMap.clear(),this}resume(){Ve(this);const e=this[Ne];return"active"!==e.state&&(e.state="active",te(()=>this[Fe]())),this}getObservableState(){return Ve(this),this[Ne].state}getBroker(){const{broker:e}=this[Ne];return e.get()}static from(e){const t=T(new class extends We{}("disabled"),e);return t.resume(),t}notify(...e){if(Ve(this),0===e.length)return;const{changeMap:t}=this[Ne],n=new Map;for(const r of e){const e=this[r],s=t.has(r)?t.get(r):e;n.set(r,[e,s])}0<n.size&&this[ze](n)}[Be](e,t){const{state:n,changeMap:r,broker:s}=this[Ne];if(this[Ne].changed=!0,0===r.size){r.set(e,t);for(const e of s.get().channels())r.has(e)||r.set(e,this[e]);"active"===n&&te(()=>this[Fe]())}else r.has(e)||r.set(e,t)}[Fe](){const{state:e,changeMap:t}=this[Ne];if("active"!==e)return;const n=new Map;for(const[e,r]of t){const t=this[e];r!==t&&n.set(e,[t,r])}this[ze](n)}[ze](e){const{changed:t,changeMap:n,broker:r}=this[Ne];n.clear(),this[Ne].changed=!1;const s=r.get();for(const[t,n]of e)s.trigger(t,...n,t);t&&s.trigger("*",this)}}const Ge={defineProperty(e,t,n){const r=e[Ne];if("disabled"===r.state||r.byMethod||!Object.prototype.hasOwnProperty.call(n,"value"))return Reflect.defineProperty(e,t,n);const s=e[t],o=n.value;if("length"===t&&o!=s){const r=s>>>0,i=o>>>0,c=()=>{const t=i<r&&e.slice(i);if(t)for(let n=r;--n>=i;)e[Be](-1,n,void 0,t[n-i]);else for(let t=r;t<i;t++)e[Be](1,t)},a=Reflect.defineProperty(e,t,n);return a&&c(),a}if(o!==s&&qe(t)){const r=t>>>0,i=Number(r>=e.length),c=Reflect.defineProperty(e,t,n);return c&&e[Be](i,r,o,s),c}return Reflect.defineProperty(e,t,n)},deleteProperty(e,t){const n=e[Ne];if("disabled"===n.state||n.byMethod||!Object.prototype.hasOwnProperty.call(e,t))return Reflect.deleteProperty(e,t);const r=e[t],s=Reflect.deleteProperty(e,t);return s&&qe(t)&&e[Be](0,t>>>0,void 0,r),s}};function qe(e){const t=String(e),n=Math.trunc(t);return String(n)===t&&0<=n&&n<4294967295}Object.freeze(Ge);class He extends Array{constructor(){super(...arguments),v("instanceOf",He,this);const e={state:"active",byMethod:!1,records:[],indexes:new Set,broker:new Ie};Object.defineProperty(this,Ne,{value:Object.seal(e)});const t=arguments.length;if(1===t&&a(arguments[0])){const e=arguments[0]>>>0;for(let t=0;t<e;t++)this[Be](1,t)}else if(0<t)for(let e=0;e<t;e++)this[Be](1,e,arguments[e]);return new Proxy(this,Ge)}on(e){return Ve(this),this[Ne].broker.get().on("@",e)}off(e){Ve(this),this[Ne].broker.get().off("@",e)}suspend(e=!1){return Ve(this),this[Ne].state=e?"disabled":"suspended",e&&(this[Ne].records=[]),this}resume(){Ve(this);const e=this[Ne];return"active"!==e.state&&(e.state="active",te(()=>this[Fe]())),this}getObservableState(){return Ve(this),this[Ne].state}sort(e){Ve(this);const t=this[Ne],n=Array.from(this);t.byMethod=!0;const r=super.sort(e);if(t.byMethod=!1,"disabled"!==t.state){const e=n.length;for(let t=0;t<e;t++){const e=n[t],r=this[t];r!==e&&this[Be](0,t,r,e)}}return r}splice(e,t,...n){Ve(this);const r=this[Ne],s=this.length;r.byMethod=!0;const o=super.splice(...arguments);if(r.byMethod=!1,"disabled"!==r.state){e=Math.trunc(e);const t=e<0?Math.max(s+e,0):Math.min(e,s);for(let e=o.length;--e>=0;)this[Be](-1,t+e,void 0,o[e]);const r=n.length;for(let e=0;e<r;e++)this[Be](1,t+e,n[e])}return o}shift(){Ve(this);const e=this[Ne],t=this.length;e.byMethod=!0;const n=super.shift();return e.byMethod=!1,"disabled"!==e.state&&this.length<t&&this[Be](-1,0,void 0,n),n}unshift(...e){Ve(this);const t=this[Ne];t.byMethod=!0;const n=super.unshift(...e);if(t.byMethod=!1,"disabled"!==t.state){const t=e.length;for(let n=0;n<t;n++)this[Be](1,n,e[n])}return n}map(e,t){return He.from([...this].map(e,t))}getBroker(){const{broker:e}=this[Ne];return e.get()}[Be](e,t,n,r){const{state:s,indexes:o,records:i}=this[Ne],c=o.has(t)?function a(e,t,n){const r=1===t?e=>-1===e:e=>-1!==e;for(let t=e.length;--t>=0;){const s=e[t];if(s.index===n&&r(s.type))return t;s.index<n&&Boolean(s.type)&&(n-=s.type)}return-1}(i,e,t):-1,u=i.length;if(c>=0){const r=i[c].type;if(r){for(let e,n=u;--n>c;)e=i[n],e.index>=t&&(e.index-=r);const s=i.splice(c,1)[0];-1!==e&&this[Be](Number(!e),t,n,s.oldValue)}else{const r=i.splice(c,1)[0];this[Be](e,t,n,r.oldValue)}}else o.add(t),i[u]={type:e,index:t,newValue:n,oldValue:r},"active"===s&&0===u&&te(()=>this[Fe]())}[Fe](){const{state:e,records:t}=this[Ne];if("active"===e&&0!==t.length){for(const e of t)Object.freeze(e);this[ze](Object.freeze(t)),this[Ne].records=[]}}[ze](e){const t=this[Ne];t.indexes.clear(),t.broker.get().trigger("@",e)}}globalThis.CDP_DECLARE=globalThis.CDP_DECLARE||{},function(){let e;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.ABORT=1]="ABORT",e[e.PENDING=2]="PENDING",e[e.NOOP=3]="NOOP",e[e.FAIL=-1]="FAIL",e[e.FATAL=-2]="FATAL",e[e.NOT_SUPPORTED=-3]="NOT_SUPPORTED"}(e=CDP_DECLARE.RESULT_CODE||(CDP_DECLARE.RESULT_CODE={})),CDP_DECLARE.ASSIGN_RESULT_CODE=function t(n){Object.assign(e,n)};const n={0:"operation succeeded.",1:"operation aborted.",2:"operation pending.",3:"no operation.","-1":"operation failed.","-2":"unexpected error occured.","-3":"operation not supported."};function r(e,t,r,s){if(t<0||1e3<=t)throw new RangeError(`declareResultCode(), invalid local-code range. [code: ${t}]`);const o=s?1:-1,i=o*(e+t);return n[i]=r||`[CODE: ${i}]`,i}CDP_DECLARE.ERROR_MESSAGE_MAP=function s(){return n},CDP_DECLARE.DECLARE_SUCCESS_CODE=function o(e,t,n){return r(e,t,n,!0)},CDP_DECLARE.DECLARE_ERROR_CODE=function i(e,t,n){return r(e,t,n,!1)}}();var Je=CDP_DECLARE.RESULT_CODE,Ze=CDP_DECLARE.DECLARE_SUCCESS_CODE,Qe=CDP_DECLARE.DECLARE_ERROR_CODE,Xe=CDP_DECLARE.ASSIGN_RESULT_CODE,Ye=CDP_DECLARE.ERROR_MESSAGE_MAP;function et(e){return e<0}function tt(e){return!et(e)}function nt(e,t){const n=t?`[${t}]`:"";return Je[e]?`${n}[${Je[e]}]`:`${n}[UNKNOWN]`}function rt(e){const t=Ye();return t[e]?t[e]:`unregistered result code. [code: ${e}]`}const st=Number.isFinite;class ot extends Error{constructor(e,t,n){e=i(e)?Je.SUCCESS:st(e)?Math.trunc(e):Je.FAIL,super(t||rt(e));let r=it(n)?n.time:void 0;st(r)||(r=Date.now());const s={code:{enumerable:!0,value:e},cause:{enumerable:!0,value:n},time:{enumerable:!0,value:r}};Object.defineProperties(this,s)}get isSucceeded(){return tt(this.code)}get isFailed(){return et(this.code)}get isCanceled(){return this.code===Je.ABORT}get codeName(){return nt(this.code,this.name)}get help(){return rt(this.code)}get[Symbol.toStringTag](){return"Result"}}function it(e){return e instanceof Error||"Error"===O(e)}ot.prototype.name="Result";class ct{constructor(){this._broker=new ye,this._storage={}}get kind(){return"memory"}async getItem(e,t){t=t||{},await $e(t.cancel);const n=oe(this._storage[e]);switch(t.dataType){case"string":return se(n);case"number":return Number(ie(n));case"boolean":return Boolean(ie(n));case"object":return Object(ie(n));default:return ie(n)}}async setItem(e,t,n){n=n||{},await $e(n.cancel);const r=oe(t,!0),s=oe(this._storage[e]);j(s,r)||(this._storage[e]=r,!n.silent&&this._broker.trigger("@",e,r,s))}async removeItem(e,t){t=t||{},await $e(t.cancel);const n=this._storage[e];void 0!==n&&(delete this._storage[e],!t.silent&&this._broker.trigger("@",e,null,n))}async clear(e){e=e||{},await $e(e.cancel),b(this._storage)||(this._storage={},!e.silent&&this._broker.trigger("@",null,null,null))}async keys(e){return await $e(e&&e.cancel),Object.keys(this._storage)}on(e){return this._broker.on("@",e)}off(e){this._broker.off("@",e)}}const at=new ct;const ut={tags:["{{","}}"],escape:re};const lt=n(null,"CDP_DECLARE","TEMPLATE_CACHE");function ft(e){return e.replace(/[-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}class ht{constructor(e){this._source=this._tail=e,this._pos=0}get pos(){return this._pos}get source(){return this._source}get eos(){return""===this._tail}scan(e){const t=e.exec(this._tail);if(!t||0!==t.index)return"";const n=t[0];return this._tail=this._tail.substring(n.length),this._pos+=n.length,n}scanUntil(e){const t=this._tail.search(e);let n;switch(t){case-1:n=this._tail,this._tail="";break;case 0:n="";break;default:n=this._tail.substring(0,t),this._tail=this._tail.substring(t)}return this._pos+=n.length,n}}class pt{constructor(e,t){this._view=e,this._cache={".":this._view},this._parent=t}get view(){return this._view}push(e){return new pt(e,this)}lookup(e){const t=this._cache;let n;if(Object.prototype.hasOwnProperty.call(t,e))n=t[e];else{let o,i,c,a=this,u=!1;for(;a;){if(0<e.indexOf("."))for(o=a._view,i=e.split("."),c=0;null!=o&&c<i.length;)c===i.length-1&&(u=ce(o,i[c])||(r=o,s=i[c],l(r)&&Object.prototype.hasOwnProperty.call(r,s))),o=o[i[c++]];else o=a._view[e],u=ce(a._view,e);if(u){n=o;break}a=a._parent}t[e]=n}var r,s;return g(n)&&(n=n.call(this._view)),n}}const bt={white:/\s*/,space:/\s+/,equals:/\s*=/,curly:/\s*\}/,tag:/#|\^|\/|>|\{|&|=|!/};class gt{parse(e,t){const n=function r(e,t){return`${e}:${t.join(":")}`}(e,t||ut.tags);let s=lt[n];return null==s&&(s=lt[n]=function o(e,t){if(!e)return[];let n=!1;const r=[],s=[],o=[];let i=!1,a=!1,u="",l=0;const h=()=>{if(i&&!a)for(;o.length;)delete s[o.pop()];else o.length=0;i=!1,a=!1},p=e=>{if(c(e)&&(e=e.split(bt.space,2)),!f(e)||2!==e.length)throw new Error(`Invalid tags: ${JSON.stringify(e)}`);return{openingTag:new RegExp(`${ft(e[0])}\\s*`),closingTag:new RegExp(`\\s*${ft(e[1])}`),closingCurly:new RegExp(`\\s*${ft(`}${e[1]}`)}`)}},{tag:b,white:g,equals:d,curly:y}=bt;let w=p(t||ut.tags);const m=new ht(e);let O;for(;!m.eos;){const{openingTag:e,closingTag:t,closingCurly:c}=w;let f,_=m.pos,S=m.scanUntil(e);if(S)for(let e=0,t=S.length;e<t;++e){const t=S.charAt(e);E=t,/\S/.test(E)?(a=!0,n=!0,u+=" "):(o.push(s.length),u+=t),s.push(["text",t,_,_+1]),_+=1,"\n"===t&&(h(),u="",l=0,n=!1)}if(!m.scan(e))break;i=!0;let v=m.scan(b)||"name";if(m.scan(g),"="===v?(S=m.scanUntil(d),m.scan(d),m.scanUntil(t)):"{"===v?(S=m.scanUntil(c),m.scan(y),m.scanUntil(t),v="&"):S=m.scanUntil(t),!m.scan(t))throw new Error(`Unclosed tag at ${m.pos}`);if(f=">"===v?[v,S,_,m.pos,u,l,n]:[v,S,_,m.pos],l++,s.push(f),"#"===v||"^"===v)r.push(f);else if("/"===v){if(O=r.pop(),!O)throw new Error(`Unopened section "${S}" at ${_}`);if(O[1]!==S)throw new Error(`Unclosed section "${O[1]}" at ${_}`)}else"name"===v||"{"===v||"&"===v?a=!0:"="===v&&(w=p(S))}var E;if(h(),O=r.pop(),O)throw new Error(`Unclosed section "${O[1]}" at ${m.pos}`);return function S(e){const t=[];let n=t;const r=[];let s;for(const o of e)switch(o[0]){case"#":case"^":n.push(o),r.push(o),n=o[4]=[];break;case"/":s=r.pop(),s[5]=o[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(o)}return t}(function _(e){const t=[];let n;for(const r of e)r&&("text"===r[0]&&n&&"text"===n[0]?(n[1]+=r[1],n[3]=r[3]):(t.push(r),n=r));return t}(s))}(e,t)),{tokens:s,cacheKey:n}}render(e,t,n,r){const{tokens:s}=this.parse(e,r);return this.renderTokens(s,t,n,e,r)}renderTokens(e,t,n,r,s){const o=t instanceof pt?t:new pt(t);let i="";for(const t of e){let e;switch(t[0]){case"#":e=this.renderSection(t,o,n,r);break;case"^":e=this.renderInverted(t,o,n,r);break;case">":e=this.renderPartial(t,o,n,s);break;case"&":e=this.unescapedValue(t,o);break;case"name":e=this.escapedValue(t,o);break;case"text":e=this.rawValue(t)}null!=e&&(i+=e)}return i}renderSection(e,t,n,r){const s=this;let o="",i=t.lookup(e[1]);const c=e=>s.render(e,t,n);if(i){if(f(i))for(const s of i)o+=this.renderTokens(e[4],t.push(s),n,r);else if("object"==typeof i||"string"==typeof i||"number"==typeof i)o+=this.renderTokens(e[4],t.push(i),n,r);else if(g(i)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");i=i.call(t.view,r.slice(e[3],e[5]),c),null!=i&&(o+=i)}else o+=this.renderTokens(e[4],t,n,r);return o}}renderInverted(e,t,n,r){const s=t.lookup(e[1]);if(!s||f(s)&&0===s.length)return this.renderTokens(e[4],t,n,r)}indentPartial(e,t,n){const r=t.replace(/[^ \t]/g,""),s=e.split("\n");for(let e=0;e<s.length;e++)s[e].length&&(e>0||!n)&&(s[e]=r+s[e]);return s.join("\n")}renderPartial(e,t,n,r){if(!n)return;const s=g(n)?n(e[1]):n[e[1]];if(null!=s){const o=e[6],i=e[5],c=e[4];let a=s;0===i&&c&&(a=this.indentPartial(s,c,o));const{tokens:u}=this.parse(a,r);return this.renderTokens(u,t,n,a)}}unescapedValue(e,t){const n=t.lookup(e[1]);if(null!=n)return n}escapedValue(e,t){const n=t.lookup(e[1]);if(null!=n)return ut.escape(n)}rawValue(e){return e[1]}}ut.writer=new gt;e.$cdp=_,e.ASSIGN_RESULT_CODE=Xe,e.CancelToken=Ae,e.CancelablePromise=xe,e.DECLARE_ERROR_CODE=Qe,e.DECLARE_SUCCESS_CODE=Ze,e.EventBroker=ye,e.EventPublisher=de,e.EventRevceiver=Ee,e.EventSource=Se,e.FAILED=et,e.MemoryStorage=ct,e.ObservableArray=He,e.ObservableObject=We,e.Promise=xe,e.PromiseManager=class dt{constructor(){this._pool=new Map}add(e,t){this._pool.set(e,t&&t.cancel);const n=()=>{this._pool.delete(e),t&&t.close()};return e.then(n,n),e}release(){this._pool.clear()}promises(){return[...this._pool.keys()]}all(){return Promise.all(this.promises())}race(){return Promise.race(this.promises())}wait(){return Le(this.promises())}abort(e){for(const t of this._pool.values())t&&t(null!=e?e:new Error("abort"));return Le(this.promises())}},e.RESULT_CODE=Je,e.Registry=class yt extends de{constructor(e,t,n){super(),this._store={},this._storage=e,this._rootKey=t,this._defaultOptions={jsonSpace:n}}get rootKey(){return this._rootKey}get storage(){return this._storage}async load(e){e=e||{},this._store=await this._storage.getItem(this._rootKey,e)||{},e.silent||te(()=>this.publish("change","*"))}async save(e){const t={...this._defaultOptions,...e};t.silent||this.publish("will-save"),await this._storage.setItem(this._rootKey,this._store,t)}read(e,t){const{field:n}=t||{},r=String(e).split("/"),s=r.pop();let o,i=this.targetRoot(n);for(;o=r.shift();){if(!(o in i))return null;i=i[o]}return null!=i[s]?D(i[s]):null}write(e,t,n){const{field:r,noSave:s,silent:o}=n||{},i=null==t,c=String(e).split("/"),a=c.pop();let u,l=this.targetRoot(r);for(;u=c.shift();)if(u in l)l=l[u];else{if(i)return;l=l[u]={}}const f=i?null:t,h=oe(l[a]);j(h,f)||(i?delete l[a]:l[a]=D(f),s||this._storage.setItem(this._rootKey,this._store,{...this._defaultOptions,...n}),o||te(()=>this.publish("change",e,f,h)))}delete(e,t){this.write(e,null,t)}clear(e){e=e||{},this._store={},this._storage.removeItem(this._rootKey,e),e.silent||this.publish("change",null,null,null)}targetRoot(e){return e?(this._store[e]=this._store[e]||{},this._store[e]):this._store}},e.Result=ot,e.SUCCEEDED=tt,e.Template=class wt{static compile(e,t){if(!c(e))throw new TypeError(`Invalid template! the first argument should be a "string" but "${function n(e){return f(e)?"array":typeof e}(e)}" was given for Template.compile(template, options)`);const{tags:r}=t||ut,{writer:s}=ut,o=(t,n)=>s.render(e,t||{},n,r),{tokens:i,cacheKey:a}=s.parse(e,r);return o.tokens=i,o.cacheKey=a,o.cacheLocation=["CDP_DECLARE","TEMPLATE_CACHE"],o}static clearCache(){!function e(){const e=r("CDP_DECLARE");e.TEMPLATE_CACHE={}}()}static setGlobalSettings(e){const t={...ut},{writer:n,tags:r,escape:s}=e;return n&&(ut.writer=n),r&&(ut.tags=r),s&&(ut.escape=s),t}static createScanner(e){return new ht(e)}static createContext(e,t){return new pt(e,t)}static createWriter(){return new gt}},e.camelize=fe,e.capitalize=ue,e.checkCanceled=$e,e.className=O,e.classify=function mt(e){return ue(fe(e.replace(/[\W_]/g," ")).replace(/\s/g,""))},e.clearInterval=ee,e.clearTimeout=X,e.createEscaper=ne,e.dasherize=function Ot(e){return e.trim().replace(/([A-Z])/g,"-$1").replace(/[_\s]+/g,"-").toLowerCase()},e.decapitalize=le,e.deepCopy=D,e.deepEqual=j,e.deepMerge=T,e.dropUndefined=oe,e.ensureObject=n,e.escapeHTML=re,e.every=async function Et(e,t,n){for(const[r,s]of e.entries())if(!await t.call(n||this,s,r,e))return!1;return!0},e.exists=o,e.extendPromise=Me,e.filter=async function _t(e,t,n){const r=await G(e,(e,r,s)=>t.call(n||this,e,r,s));return e.filter(()=>r.shift())},e.find=async function St(e,t,n){for(const[r,s]of e.entries())if(await t.call(n||this,s,r,e))return s},e.findIndex=async function vt(e,t,n){for(const[r,s]of e.entries())if(await t.call(n||this,s,r,e))return r;return-1},e.fromTypedData=se,e.getConfig=s,e.getGlobal=t,e.getGlobalNamespace=r,e.groupBy=function Pt(e,t){const{keys:n,sumKeys:r,groupKey:s}=t,o=s||"items",i=r||[];i.push(o);const c=e.reduce((e,t)=>{const r=n.reduce((e,n)=>e+String(t[n]),"");if(!(r in e)){const s=n.reduce((e,n)=>(e[n]=t[n],e),{});e[r]=i.reduce((e,t)=>(e[t]=0,e),s)}const s=e[r];for(const e of i)o===e?(s[e]=s[e]||[],s[e].push(t)):s[e]+=t[e];return e},{});return Object.values(c)},e.hasProperty=ce,e.indices=function Ct(e,...t){const n=[...e.keys()],r=e.length,s=[...new Set(t)].sort((e,t)=>e<t?1:-1);for(const e of s)0<=e&&e<r&&n.splice(e,1);return n},e.instanceOf=function jt(e,t){return"function"==typeof e&&t instanceof e},e.isArray=f,e.isBoolean=function Rt(e){return"boolean"==typeof e},e.isChancelLikeError=function At(e){return null!=e&&(c(e)?Ue.test(e):!!h(e)&&Ue.test(e.message))},e.isEmptyObject=b,e.isFunction=g,e.isIterable=d,e.isNil=i,e.isNumber=a,e.isObject=h,e.isObservable=function kt(e){return Boolean(e&&e[Ne])},e.isPlainObject=p,e.isPrimitive=l,e.isResult=function Tt(e){return e instanceof ot||"Result"===O(e)},e.isString=c,e.isSymbol=u,e.isTypedArray=w,e.luid=function Dt(e="",t){const n=(++ae).toString(16);return null!=t?`${e}${n.padStart(t,"0")}`:`${e}${n}`},e.makeCanceledResult=function xt(e,t){return new ot(Je.ABORT,e,t)},e.makeResult=function Mt(e,t,n){return new ot(e,t,n)},e.map=G,e.memoryStorage=at,e.mixins=K,e.noop=function Lt(...e){},e.ownInstanceOf=m,e.partialize=function $t(e,...t){if(!e||!h(e))throw new TypeError(`${O(e)} is not an object.`);return t.reduce((t,n)=>(n in e&&(t[n]=e[n]),t),{})},e.post=te,e.reduce=async function Ut(e,t,n){if(e.length<=0&&void 0===n)throw TypeError("Reduce of empty array with no initial value");const r=void 0!==n;let s=r?n:e[0];for(const[n,o]of e.entries())(r||0!==n)&&(s=await t(s,o,n,e));return s},e.restoreNil=ie,e.safe=J,e.sameClass=E,e.sameType=function It(e,t){return typeof e==typeof t},e.setInterval=Y,e.setMixClassAttribute=function Nt(e,t,n){switch(t){case"protoExtendsOnly":e[z]=!0;break;case"instanceOf":V(e,n)}},e.setTimeout=Q,e.shuffle=function zt(e,t=!1){const n=t?e:e.slice(),r=n.length;for(let e=r>0?r>>>0:0;e>1;){const t=e*W()>>>0,r=n[--e];n[e]=n[t],n[t]=r}return n},e.sleep=function Bt(e){return new Promise(t=>Q(t,e))},e.some=async function Ft(e,t,n){for(const[r,s]of e.entries())if(await t.call(n||this,s,r,e))return!0;return!1},e.sort=function e(t,n,r=!1){const s=r?t:t.slice();if(s.length<2)return s;const o=e(s.splice(0,s.length>>>1),n,!0),i=e(s.splice(0),n,!0);for(;o.length&&i.length;)s.push(n(o[0],i[0])<=0?o.shift():i.shift());return s.concat(o,i)},e.toHelpString=rt,e.toNameString=nt,e.toResult=function Vt(e){if(e instanceof ot){let{code:t,cause:n,time:r}=e;return t=i(t)?Je.SUCCESS:st(t)?Math.trunc(t):Je.FAIL,st(r)||(r=Date.now()),Reflect.defineProperty(e,"code",{enumerable:!0,value:t}),Reflect.defineProperty(e,"cause",{enumerable:!0,value:n}),Reflect.defineProperty(e,"time",{enumerable:!0,value:r}),e}{const t=Object(e),n=st(t.code)?t.code:e,r=c(t.message)?t.message:c(e)?e:void 0,s=it(t.cause)?t.cause:it(e)?e:c(e)?new Error(e):e;return new ot(n,r,s)}},e.toTypedData=function Kt(e){return"true"===e||"false"!==e&&("null"===e?null:e===String(Number(e))?Number(e):e&&/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/.test(e)?JSON.parse(e):e)},e.typeOf=function Wt(e,t){return typeof t===e},e.underscored=function Gt(e){return e.trim().replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},e.unique=function qt(e){return[...new Set(e)]},e.verify=v,e.wait=Le,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=framework-core.min.map